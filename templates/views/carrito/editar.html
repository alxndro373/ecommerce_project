{% extends "index.html" %}
{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow">
        <div class="card-header bg-success text-white">
          <h3 class="text-center">Crear Carrito</h3>
        </div>
        <div class="card-body">
          <form action="{{ url_for('carrito.editar', id=carrito._id) }}" method="POST">
            <div class="mb-3">
              <label for="carrito_id" class="form-label fw-bold">ID Carrito</label>
              <input type="text" id="carrito_id" name="carrito_id" class="form-control" value="{{ carrito.carrito_id }}" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Usuario</label>
              <select name="usuario_id" class="form-select" required>
                <option value="">Selecciona Usuario</option>
                {% for u in usuario %}
                <option value="{{ u.usuario_id }}" {% if u.usuario_id == carrito.usuario_id %}selected{% endif %}>{{ u.usuario_id }} - {{ u.nombre }}</option>
                {% endfor %}
              </select>
            </div>
            <!-- FALTA MOSTRAR LOS PRODUCTOS ACTUALES DEL USUARIO -->
            <div class="mb-3">
              <label class="form-label">Productos</label>
              <div class="border p-2" style="max-height: 150px; overflow-y:auto;">
                {% for p in producto %}
                <div class="form-check">
                    <input class="form-check-input producto-check" type="checkbox" 
                        name="producto_id" 
                        value="{{ p.producto_id }}" 
                        data-precio="{{ p.precio }}">
                    <label class="form-check-label">
                    {{ p.producto_id }} - {{ p.nombre }} ({{ p.precio }} MXN)
                    </label>
                </div>
                {% endfor %}
              </div>
            </div>
            <!-- FALTA MOSTRAR EL TOTAL ACTUAL DE LOS PRODUCTOS DEL USUARIO -->
            <div class="mb-3">
              <label class="form-label">Total</label>
              <input type="number" step="0.01" id="total" class="form-control" readonly>
            </div>
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-success">Guardar Carrito</button>
              <a href="{{ url_for('carrito.listar') }}" class="btn btn-secondary">Cancelar</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const checkboxes = document.querySelectorAll(".producto-check");
    const totalInput = document.getElementById("total");

    function calcularTotal() {
      let total = 0;
      checkboxes.forEach(chk => {
        if (chk.checked) {
          total += parseFloat(chk.dataset.precio);
        }
      });
      totalInput.value = total.toFixed(2);
    }

    checkboxes.forEach(chk => chk.addEventListener("change", calcularTotal));
  });
</script>
{% endblock %}