{% extends "index.html" %}
{% block content %}
<h2 class="mb-3">Gestión de Carritos</h2>
<div class="card mb-4">
  <div class="card-header bg-success text-white">
    Agregar nuevo carrito
  </div>
  <div class="card-body">
  <form action="{{ url_for('carrito.crear') }}" method="POST" class="row g-3">
    <div class="col-md-2">
      <label class="form-label">ID Carrito</label>
      <input type="number" name="carrito_id" class="form-control" required>
    </div>

    <div class="col-md-3">
      <label class="form-label">Usuario</label>
      <select name="usuario_id" class="form-select" required>
        <option value="">-- Selecciona Usuario --</option>
        {% for u in usuarios %}
          <option value="{{ u.usuario_id }}">{{ u.usuario_id }} - {{ u.nombre }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-5">
      <label class="form-label">Productos</label>
      <div class="border p-2" style="max-height: 150px; overflow-y:auto;">
        {% for p in productos %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="producto_id" value="{{ p.producto_id }}">
            <label class="form-check-label">
              {{ p.producto_id }} - {{ p.nombre }} ({{ p.precio }} MXN)
            </label>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="col-md-2">
      <label class="form-label">Total</label>
      <input type="number" step="0.01" name="total" class="form-control" required>
    </div>

    <div class="col-12 text-end">
      <button type="submit" class="btn btn-success">Agregar</button>
    </div>
  </form>
  </div>
</div>

<div class="card">
  <div class="card-header bg-dark text-white">
    Lista de Carritos
  </div>
  <div class="card-body">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID Carrito</th>
          <th>Usuario ID</th>
          <th>Productos</th>
          <th>Total</th>
          <th>Fecha actualización</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
      {% for ca in carritos %}
        <tr>
          <form action="{{ url_for('carrito.editar', id=ca._id) }}" method="POST">
            <td>{{ ca.carrito_id }}</td>
            <td>
              <select name="usuario_id" class="form-select">
                <option value="{{ ca.usuario_id }}"></option>
                {% for u in usuarios %}
                  <option value="{{ u.usuario_id }}">{{ u.usuario_id }} - {{ u.nombre }}</option>
                {% endfor %}
              </select>
            </td>
            <td>
              <input type="text" name="producto_id" value="{{ ca.producto_id | join(',') }}" 
                     class="form-control">
            </td>
            <td><input type="number" step="0.01" name="total" value="{{ ca.total }}" class="form-control"></td>
            <td>{{ ca.fecha_actualizacion }}</td>
            <td>
              <button type="submit" class="btn btn-primary btn-sm">Guardar</button>
              <a href="{{ url_for('carrito.eliminar', id=ca._id) }}" class="btn btn-danger btn-sm"
                 onclick="return confirm('¿Eliminar este carrito?');">Eliminar</a>
            </td>
          </form>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
